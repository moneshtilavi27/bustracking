let Joi,getData,CustomErrorHandler,paginationQuery;_dae‍.x([["default",()=>_dae‍.o]]);_dae‍.w("joi",[["default",["Joi"],function(v){Joi=v}]]);_dae‍.w("../../config/index.js",[["getData",["getData"],function(v){getData=v}]]);_dae‍.w("../../service/index.js",[["CustomErrorHandler",["CustomErrorHandler"],function(v){CustomErrorHandler=v}]]);_dae‍.w("../../helper/index.js",[["paginationQuery",["paginationQuery"],function(v){paginationQuery=v}]]);




const userController = {
    async user(req, res, next) {
        let query = "SELECT *,(SELECT COUNT(`spid`) FROM `cattle_list` WHERE `user_id` = `id`) AS `total_animal` FROM `addowner` WHERE 1 ";
        let cond = '';
        let page = {pageQuery:''};

        const userSchema = Joi.object({
            user_id: Joi.number().integer(),
            userName: Joi.string(),
            phone: Joi.number().integer(),
            userType: Joi.string(),
            pincode: Joi.number().integer(),
            state: Joi.string(),
            dist: Joi.string(),
            created_by: Joi.string(),
            client_id: Joi.string(),
            pagination: Joi.boolean(),
            current_page: Joi.number().integer(),
            per_page_records: Joi.number().integer()
        });

        
        const { error } = userSchema.validate(req.body);
        if (error) {
            return next(error);
        }

        if (req.body.user_id)
            cond += " AND id = '" + req.body.user_id + "'";
        if (req.body.userName)
            cond += " AND name LIKE '%" + req.body.userName + "%'";
        if (req.body.phone)
            cond += " AND phone = '" + req.body.phone + "'";
        if (req.body.userType)
            cond += " AND userType = '" + req.body.userType + "'";
        if (req.body.pincode)
            cond += " AND pincode = '" + req.body.pincode + "'";
        if (req.body.state)
            cond += " AND state = '" + req.body.state + "'";
        if (req.body.dist)
            cond += " AND dist = '" + req.body.dist +"'";
        if (req.body.created_by)
            cond += " AND created_by = '" + req.body.created_by + "'";
        if (req.body.client_id)
            cond += " AND client_id = '" + req.body.client_id + "'";
        if (req.body.syncher)
            cond += " AND syncer = '" + req.body.syncher + "'";
        if (req.body.pagination)
            page = await paginationQuery(query+cond,next,req.body.current_page, req.body.per_page_records);

        query += cond + " ORDER BY `id` DESC " + page.pageQuery;
       
        await getData(query, next).then(async (data) => {
            data.forEach((value, index) => {
                delete data[index].password;
            });
            res.json({
                message: 'success',
                total_records: page.total_rec,
                number_of_pages: page.number_of_pages,
                records: data.length,
                data: data,
            });
        });
    }
}


_dae‍.d(userController);